{"version":3,"file":"bundle.cjs.js","sources":["bundle.esm.js"],"sourcesContent":["import { __assign, __extends } from 'tslib';\nimport { Observable, ApolloLink } from 'apollo-link';\n\nvar OperationBatcher = (function () {\n    function OperationBatcher(_a) {\n        var batchInterval = _a.batchInterval, batchMax = _a.batchMax, batchHandler = _a.batchHandler, batchKey = _a.batchKey;\n        this.queuedRequests = new Map();\n        this.batchInterval = batchInterval;\n        this.batchMax = batchMax || 0;\n        this.batchHandler = batchHandler;\n        this.batchKey = batchKey || (function () { return ''; });\n    }\n    OperationBatcher.prototype.enqueueRequest = function (request) {\n        var _this = this;\n        var requestCopy = __assign({}, request);\n        var queued = false;\n        var key = this.batchKey(request.operation);\n        if (!requestCopy.observable) {\n            requestCopy.observable = new Observable(function (observer) {\n                if (!_this.queuedRequests.has(key)) {\n                    _this.queuedRequests.set(key, []);\n                }\n                if (!queued) {\n                    _this.queuedRequests.get(key).push(requestCopy);\n                    queued = true;\n                }\n                requestCopy.next = requestCopy.next || [];\n                if (observer.next)\n                    requestCopy.next.push(observer.next.bind(observer));\n                requestCopy.error = requestCopy.error || [];\n                if (observer.error)\n                    requestCopy.error.push(observer.error.bind(observer));\n                requestCopy.complete = requestCopy.complete || [];\n                if (observer.complete)\n                    requestCopy.complete.push(observer.complete.bind(observer));\n                if (_this.queuedRequests.get(key).length === 1) {\n                    _this.scheduleQueueConsumption(key);\n                }\n                if (_this.queuedRequests.get(key).length === _this.batchMax) {\n                    _this.consumeQueue(key);\n                }\n            });\n        }\n        return requestCopy.observable;\n    };\n    OperationBatcher.prototype.consumeQueue = function (key) {\n        var requestKey = key || '';\n        var queuedRequests = this.queuedRequests.get(requestKey);\n        if (!queuedRequests) {\n            return;\n        }\n        this.queuedRequests.delete(requestKey);\n        var requests = queuedRequests.map(function (queuedRequest) { return queuedRequest.operation; });\n        var forwards = queuedRequests.map(function (queuedRequest) { return queuedRequest.forward; });\n        var observables = [];\n        var nexts = [];\n        var errors = [];\n        var completes = [];\n        queuedRequests.forEach(function (batchableRequest, index) {\n            observables.push(batchableRequest.observable);\n            nexts.push(batchableRequest.next);\n            errors.push(batchableRequest.error);\n            completes.push(batchableRequest.complete);\n        });\n        var batchedObservable = this.batchHandler(requests, forwards) || Observable.of();\n        var onError = function (error) {\n            errors.forEach(function (rejecters) {\n                if (rejecters) {\n                    rejecters.forEach(function (e) { return e(error); });\n                }\n            });\n        };\n        batchedObservable.subscribe({\n            next: function (results) {\n                if (!Array.isArray(results)) {\n                    results = [results];\n                }\n                if (nexts.length !== results.length) {\n                    var error = new Error(\"server returned results with length \" + results.length + \", expected length of \" + nexts.length);\n                    error.result = results;\n                    return onError(error);\n                }\n                results.forEach(function (result, index) {\n                    if (nexts[index]) {\n                        nexts[index].forEach(function (next) { return next(result); });\n                    }\n                });\n            },\n            error: onError,\n            complete: function () {\n                completes.forEach(function (complete) {\n                    if (complete) {\n                        complete.forEach(function (c) { return c(); });\n                    }\n                });\n            },\n        });\n        return observables;\n    };\n    OperationBatcher.prototype.scheduleQueueConsumption = function (key) {\n        var _this = this;\n        var requestKey = key || '';\n        setTimeout(function () {\n            if (_this.queuedRequests.get(requestKey) &&\n                _this.queuedRequests.get(requestKey).length) {\n                _this.consumeQueue(requestKey);\n            }\n        }, this.batchInterval);\n    };\n    return OperationBatcher;\n}());\n\nvar BatchLink = (function (_super) {\n    __extends(BatchLink, _super);\n    function BatchLink(fetchParams) {\n        var _this = _super.call(this) || this;\n        var _a = fetchParams || {}, _b = _a.batchInterval, batchInterval = _b === void 0 ? 10 : _b, _c = _a.batchMax, batchMax = _c === void 0 ? 0 : _c, _d = _a.batchHandler, batchHandler = _d === void 0 ? function () { return null; } : _d, _e = _a.batchKey, batchKey = _e === void 0 ? function () { return ''; } : _e;\n        _this.batcher = new OperationBatcher({\n            batchInterval: batchInterval,\n            batchMax: batchMax,\n            batchHandler: batchHandler,\n            batchKey: batchKey,\n        });\n        if (fetchParams.batchHandler.length <= 1) {\n            _this.request = function (operation) { return _this.batcher.enqueueRequest({ operation: operation }); };\n        }\n        return _this;\n    }\n    BatchLink.prototype.request = function (operation, forward) {\n        return this.batcher.enqueueRequest({\n            operation: operation,\n            forward: forward,\n        });\n    };\n    return BatchLink;\n}(ApolloLink));\n\nexport { BatchLink, OperationBatcher };\n//# sourceMappingURL=bundle.esm.js.map\n"],"names":["__assign","Observable","__extends","ApolloLink"],"mappings":"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"}